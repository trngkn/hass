alias: Zalo - Create Image Bot Answer Multi Group
description: ""
triggers:
  - trigger: webhook
    allowed_methods:
      - POST
      - PUT
      - GET
      - HEAD
    local_only: false
    webhook_id: "láº¥y webhook zalo_bot nhÆ° cá»§a cá»¥ Äen Ä‘ang dÃ¹ng"
conditions:
  - condition: template
    value_template: |
      {{ 'táº¡o áº£nh' in trigger.json.data.content|lower }}
    enabled: false
  - condition: template
    value_template: >-
      {{ trigger.json.data.content | default('')| lower | regex_search('táº¡o
      áº£nh|táº¡o má»™t bá»©c áº£nh|táº¡o bá»©c áº£nh')}}
actions:
  - variables:
      user_message: "{{ trigger.json.data.content }}"
      conversation_id: "{{ trigger.json.data.uidFrom }}"
  - action: ai_task.generate_image
    metadata: {}
    data:
      task_name: Zalo Group Create Image
      entity_id: ai_task.gemini_2_5_flash_ai_task
      instructions: "{{ user_message }}"
    response_variable: zalo_group_ai_create_image
  - wait_template: >-
      {{ zalo_group_ai_create_image.media_source_id is defined and
      zalo_group_ai_create_image is defined }}
    continue_on_timeout: true
    timeout: "00:02:00"
  - if:
      - condition: template
        value_template: "{{ wait.completed }}"
    then:
      - choose:
          - conditions:
              - condition: template
                value_template: "{{ trigger.json.threadId == 'Ä‘á»•i id cá»§a báº¡n' }}"
            sequence:
              - action: zalo_bot.send_image
                metadata: {}
                data:
                  type: "1"
                  ttl: 0
                  image_path: >-
                    {{ zalo_group_ai_create_image.media_source_id |
                    replace('media-source://', '/media/') }}
                  message: ÄÃ£ {{user_message|lower}}
                  thread_id: "Ä‘á»•i id cá»§a báº¡n"
                  account_selection: "Äá»•i sá»‘ Ä‘t zalo bot cá»§a báº¡n"
          - conditions:
              - condition: template
                value_template: "{{ trigger.json.threadId == 'Ä‘á»•i id cá»§a báº¡n' }}"
            sequence:
              - action: zalo_bot.send_image
                metadata: {}
                data:
                  type: "1"
                  ttl: 0
                  image_path: >-
                    {{ zalo_group_ai_create_image.media_source_id |
                    replace('media-source://', '/media/') }}
                  message: ÄÃ£ {{user_message|lower}}
                  account_selection: "Äá»•i sá»‘ Ä‘t zalo bot cá»§a báº¡n"
                  thread_id: "Ä‘á»•i id cá»§a báº¡n"
          - conditions:
              - condition: template
                value_template: "{{ trigger.json.threadId == 'Ä‘á»•i id cá»§a báº¡n' }}"
            sequence:
              - action: zalo_bot.send_image
                metadata: {}
                data:
                  type: "0"
                  ttl: 0
                  image_path: >-
                    {{ zalo_group_ai_create_image.media_source_id |
                    replace('media-source://', '/media/') }}
                  message: ÄÃ£ {{user_message|lower}}
                  account_selection: "+á»•i sá»‘ Ä‘t zalo bot cá»§a báº¡n""
                  thread_id: "Ä‘á»•i id cá»§a báº¡n"
          - conditions:
              - condition: template
                value_template: "{{ trigger.json.threadId == 'Ä‘á»•i id cá»§a báº¡n' }}"
            sequence:
              - action: zalo_bot.send_image
                metadata: {}
                data:
                  type: "1"
                  ttl: 0
                  image_path: >-
                    {{ zalo_group_ai_create_image.media_source_id |
                    replace('media-source://', '/media/') }}
                  message: ÄÃ£ {{user_message|lower}}
                  account_selection: "+á»•i sá»‘ Ä‘t zalo bot cá»§a báº¡n"
                  thread_id: "Ä‘á»•i id cá»§a báº¡n"
    else:
      - variables:
          ai_error: >
            ğŸ¤–ğŸ’¥ AI bá»‹ há»¥t cáº£m há»©ng, chÆ°a táº¡o Ä‘Æ°á»£c áº£nh!{{'\n'}}ğŸ” HÃ£y thá»­ láº¡i
            láº§n ná»¯a nhÃ©.{{'\n'}}ğŸ•’ {{ now().strftime('%H:%M:%S %a, %d-%b-%Y') }}
      - choose:
          - conditions:
              - condition: template
                value_template: "{{ trigger.json.threadId == 'Ä‘á»•i id cá»§a báº¡n' }}"
            sequence:
              - action: zalo_bot.send_message
                metadata: {}
                data:
                  type: "1"
                  ttl: 0
                  thread_id: "Ä‘á»•i id cá»§a báº¡n"
                  account_selection: "Äá»•i sá»‘ Ä‘t zalo bot cá»§a báº¡n"
                  message: "{{ ai_error }}"
          - conditions:
              - condition: template
                value_template: "{{ trigger.json.threadId == 'Ä‘á»•i id cá»§a báº¡n' }}"
            sequence:
              - action: zalo_bot.send_message
                metadata: {}
                data:
                  type: "1"
                  ttl: 0
                  account_selection: "Äá»•i sá»‘ Ä‘t zalo bot cá»§a báº¡n"
                  message: "{{ ai_error }}"
                  thread_id: "Ä‘á»•i id cá»§a báº¡n"
          - conditions:
              - condition: template
                value_template: "{{ trigger.json.threadId == 'Ä‘á»•i id cá»§a báº¡n' }}"
            sequence:
              - action: zalo_bot.send_message
                metadata: {}
                data:
                  type: "0"
                  ttl: 0
                  account_selection: "Äá»•i sá»‘ Ä‘t zalo bot cá»§a báº¡n"
                  message: "{{ ai_error }}"
                  thread_id: "Ä‘á»•i id cá»§a báº¡n"
          - conditions:
              - condition: template
                value_template: "{{ trigger.json.threadId == 'Ä‘á»•i id cá»§a báº¡n' }}"
            sequence:
              - action: zalo_bot.send_message
                metadata: {}
                data:
                  type: "1"
                  ttl: 0
                  account_selection: "Ä‘á»•i sá»‘ Ä‘t zalo bot cá»§a báº¡n"
                  message: "{{ ai_error }}"
                  thread_id: "Ä‘á»•i id cá»§a báº¡n"
mode: parallel
max: 50
